# Token 成本估算（全功能解锁后）

> 口径：这里的「token」指 **LLM token**（输入 + 输出）。  
> 方法：用真实牌面文案拼接出请求体，再用启发式估算：**中文字符≈1 token**、非中文字符≈4字符/1 token。  
> 所以这是**近似值**，但足够用于做“降本决策”。

## 1) 单次调用的 token 量（按功能）

| 功能模式 | 输入 token（约） | 输出 token（典型） | 输出上限（max_tokens） | 合计（典型） | 合计（最坏） |
|---|---:|---:|---:|---:|---:|
| daily（每日签） | 285 | 200 | 320 | 485 | 605 |
| draw: spread（牌阵解读） | 276 | 300 | 520 | 576 | 796 |
| draw: topic（三体融合专项） | 612 | 400 | 520 | 1012 | 1132 |
| dream（梦境解码） | 271 | 250 | 360 | 521 | 631 |
| compatibility（合盘） | 228 | 250 | 360 | 478 | 588 |

## 2) “解锁全部功能跑一遍”的总成本（今晚 MVP）

假设一个用户完整体验一次：
- 每日签 1 次
- 占卜（牌阵）1 次
- 占卜（专题三体）1 次
- 合盘 1 次
- 解梦 1 次

则总 token 约为：
- **典型总计**：约 **3072 tokens / 用户**
- **最坏总计**：约 **3752 tokens / 用户**

## 3) 降本优化优先级（从最值到最不值）

### A. 最值（立刻省大头）

- **压缩输入牌义**：当前请求里会把每张牌的 upright/reversed 全文本塞进去，输入 token 会被“牌义长度”放大。  
  建议改成：
  - 每张牌仅传：牌名、正逆位、**3~8 个关键词**（本地生成/预置）
  - 或只传牌 ID，让服务端把“短牌义”拼进去

### B. 次值（稳定省 + 体验更快）

- **缓存可复用结果**：
  - `daily`：按（日期+牌+正逆位）缓存 24h
  - `spread/topic/compat`：按（牌面组合）缓存 7 天
  - `dream`：默认不缓存；如要缓存需用户显式同意 + 加密

### C. 小值（锦上添花）

- **再降 `max_tokens`**：在保证质量的情况下逐步收缩输出上限（尤其是 topic）
- **收紧文案长度要求**：把“字数上限”再降 20%（例如 topic 400→320）

